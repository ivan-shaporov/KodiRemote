{
    "version": "2.0.0",
    "tasks": [
        {
            "label": "buildDebug",
            "type": "shell",
            "command": "./gradlew assembleDebug",
            "group": {
                "kind": "build",
                "isDefault": true
            },
            "presentation": {
                "reveal": "always",
                "panel": "new"
            },
            "problemMatcher": []
        },
        {
            "label": "installWatch",
            "type": "shell",
            "command": "adb -s ${config:kodiremote.watchSerial} install -r app/build/outputs/apk/debug/app-debug.apk",
            "dependsOn": [
                "connectWatch",
                "buildDebug"
            ],
            "problemMatcher": []
        },
        {
            "label": "runWatch",
            "type": "shell",
            "command": "adb -s ${config:kodiremote.watchSerial} shell am start -n com.dom.kodiremote/.presentation.MainActivity",
            "dependsOn": "installWatch",
            "problemMatcher": []
        },
        {
            "label": "runWatchWaitForDebugger",
            "type": "shell",
            "command": "adb -s ${config:kodiremote.watchSerial} shell am start -D -n com.dom.kodiremote/.presentation.MainActivity",
            "dependsOn": "installWatch",
            "problemMatcher": []
        },
        {
            "label": "forwardJdwpWatch",
            "type": "shell",
            "command": "powershell",
            "args": [
                "-NoProfile",
                "-Command",
                "$ErrorActionPreference='Stop'; $serial='${config:kodiremote.watchSerial}'; $pkg='com.dom.kodiremote'; $pid=(adb -s $serial shell pidof -s $pkg).Trim(); if (-not $pid) { throw 'Could not find app PID. Is the app running and debuggable?'; }; adb -s $serial forward tcp:8700 jdwp:$pid; Write-Host ('Forwarded tcp:8700 -> jdwp:' + $pid)"
            ],
            "dependsOn": "runWatchWaitForDebugger",
            "problemMatcher": []
        },
        {
            "label": "installEmulator",
            "type": "shell",
            "command": "adb -s emulator-5554 install -r app/build/outputs/apk/debug/app-debug.apk",
            "dependsOn": "buildDebug",
            "problemMatcher": []
        },
        {
            "label": "runEmulator",
            "type": "shell",
            "command": "adb -s emulator-5554 shell am start -n com.dom.kodiremote/.presentation.MainActivity",
            "dependsOn": "installEmulator",
            "problemMatcher": []
        },
        {
            "label": "stopApp",
            "type": "shell",
            "command": "adb shell am force-stop com.dom.kodiremote",
            "problemMatcher": []
        },
        {
            "label": "stopWatch",
            "type": "shell",
            "command": "adb -s ${config:kodiremote.watchSerial} shell am force-stop com.dom.kodiremote",
            "problemMatcher": []
        },
        {
            "label": "connectWatch",
            "type": "shell",
            "command": "adb connect ${config:kodiremote.watchSerial}",
            "problemMatcher": []
        },
        {
            "label": "startEmulatorDetached",
            "type": "shell",
            "command": "cmd.exe",
            "args": [
                "/c",
                "start",
                "\"\"",
                "emulator.exe",
                "-avd",
                "Wear_OS_Large_Round"
            ],
            "problemMatcher": []
        }
    ]
}